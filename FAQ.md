# Часто задаваемые вопросы (FAQ) по Ansible проекту

## 1. Какие требования к серверу?

Ваш сервер должен:
- Иметь операционную систему Ubuntu 22.04
- Быть доступен по SSH
- Иметь пользователя с правами sudo (если плейбук будет выполнять привилегированные действия)

## 2. Почему я получаю ошибку "Permission denied (publickey)"?

Это означает, что SSH-ключ не был правильно скопирован на сервер. Проверьте:
- Что вы сгенерировали SSH-ключ на сервере
- Что вы добавили публичный ключ в файл authorized_keys
- Что права доступа к файлам ключей корректны (обычно 600 для приватного ключа)

## 3. Как проверить, что SSH-подключение работает?

Выполните команду на сервере:
```bash
ssh -i ~/.ssh/id_rsa username@localhost
```

Если подключение проходит без запроса пароля, значит SSH-ключи настроены правильно.

## 4. Какие переменные среды обязательны?

Обязательные переменные среды для CI/CD:
- `SERVER_IP`: IP-адрес вашего сервера
- `ANSIBLE_USER`: Имя пользователя на сервере, от которого будет происходить подключение
- `SSH_PRIVATE_KEY`: Приватный SSH-ключ, сгенерированный на сервере

Необязательные переменные:
- `DB_PASSWORD`: Пароль для базы данных (если используется)

## 5. Как убедиться, что плейбук выполнится безопасно?

Ansible по умолчанию работает в режиме "идемпотентности", то есть многократный запуск одного и того же плейбука должен приводить к одному и тому же результату. Тем не менее:
- Всегда тестируйте плейбуки на тестовом сервере перед запуском на продакшене
- Используйте флаг `--check` для запуска в режиме "сухого" тестирования (локально): `ansible-playbook --check -i inventory.ini playbooks/initial_setup.yml`

## 6. Как обновить плейбук после внесения изменений?

После внесения изменений в плейбук:
1. Убедитесь, что синтаксис корректен: `ansible-playbook --syntax-check playbooks/your_playbook.yml`
2. Запустите плейбук через CI/CD pipeline (не локально)

## 7. Какие меры безопасности следует принимать?

- Никогда не храните чувствительные данные в файлах плейбуков
- Используйте Ansible Vault для хранения паролей и других конфиденциальных данных
- Убедитесь, что файлы с SSH-ключами имеют правильные права доступа
- Не коммитьте файлы с конфиденциальной информацией в репозиторий
- Генерируйте SSH-ключи на сервере, а не на управляющей машине

## 8. Как работает GitHub Actions в этом проекте?

GitHub Actions автоматизирует процесс деплоя:
1. При пуше в ветку main запускается workflow
2. Устанавливаются зависимости
3. Настраивается SSH-агент с приватным ключом из секрета (ключ не сохраняется на диске runner'а)
4. Генерируется файл inventory из шаблона
5. Выполняется плейбук Ansible на удаленном сервере

Для корректной работы необходимо настроить следующие секреты в репозитории:
- `SERVER_IP`
- `ANSIBLE_USER`
- `SSH_PRIVATE_KEY`
- `DB_PASSWORD` (если используется)

## 9. Что делать, если GitHub Actions завершается с ошибкой?

Частые причины ошибок:
- Неправильно настроенные секреты в репозитории
- Проблемы с SSH-ключами
- Недоступность сервера по указанному IP
- Отсутствие прав доступа

Проверьте логи выполнения workflow для получения деталей ошибки.

## 10. Можно ли использовать этот проект с другими Linux дистрибутивами?

Текущий плейбук предназначен для Ubuntu 22.04, но его можно адаптировать для других дистрибутивов:
- Измените команды управления пакетами (apt на yum, dnf или apk)
- Проверьте совместимость устанавливаемых пакетов
- Обновите пути к исполняемым файлам, если они отличаются

## 11. Почему генерация ключа происходит на сервере?

Генерация SSH-ключа на сервере повышает безопасность, потому что:
- Приватный ключ никогда не покидает сервер
- Только публичный ключ (безопасный) передается в CI/CD систему
- Это соответствует принципу минимальных привилегий и безопасности