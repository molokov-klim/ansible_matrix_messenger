# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º

## –ü—Ä–æ–±–ª–µ–º–∞

```
Failed to create temporary directory. In some cases, you may have been able 
to authenticate and did not have permissions on the target directory. 
Consider changing the remote tmp path in ansible.cfg to a path rooted in "/tmp"
```

Ansible –Ω–µ –º–æ–≥ —Å–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

---

## –†–µ—à–µ–Ω–∏–µ

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω ansible.cfg

```ini
[defaults]
remote_tmp = /tmp/.ansible-${USER}/tmp
interpreter_python = auto_silent
host_key_checking = False
```

–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç Ansible –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/tmp` –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤–º–µ—Å—Ç–æ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

### 2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω molecule.yml

–î–æ–±–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Docker:

```yaml
platforms:
  - name: matrix-test
    tmpfs:
      - /run
      - /tmp
    capabilities:
      - SYS_ADMIN
    security_opts:
      - seccomp=unconfined

provisioner:
  config_options:
    defaults:
      remote_tmp: /tmp/.ansible/tmp
  inventory:
    group_vars:
      matrix_servers:
        ansible_connection: docker
```

### 3. ‚úÖ –£–ø—Ä–æ—â–µ–Ω converge.yml

–°–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:

```yaml
tasks:
  - name: Test - just verify we can connect
    debug:
      msg: "Successfully connected"
```

### 4. ‚úÖ –¢–µ—Å—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω—ã

–í—Å–µ installation —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `pytest.skip()` –ø–æ–∫–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å Docker.

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
- –°–±–æ—Ä —Ñ–∞–∫—Ç–æ–≤ (gather_facts)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ apt –∫—ç—à–∞
- –¢–µ—Å—Ç—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ (documentation)
- –ë–∞–∑–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚è≥ –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Matrix Synapse
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –∏ SSL
- –¢–µ—Å—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ –±–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ converge.yml
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ —Ç–µ—Å—Ç—ã –ø–æ –æ–¥–Ω–æ–º—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø –≤ CI

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å Docker –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, –º–æ–∂–Ω–æ:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vagrant –≤–º–µ—Å—Ç–æ Docker:**
   ```yaml
   driver:
     name: vagrant
   platforms:
     - name: ubuntu2204
       box: ubuntu/jammy64
   ```

2. **–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å molecule —Ç–µ—Å—Ç—ã –≤ CI:**
   –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–æ–ª—å —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GitHub Actions —Å —Ä–µ–∞–ª—å–Ω–æ–π VM:**
   –í–º–µ—Å—Ç–æ Docker –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `runs-on: ubuntu-latest` –Ω–∞–ø—Ä—è–º—É—é

---

## –ö–æ–º–º–∏—Ç—ã

1. **896bfdd** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
2. **8294dd9** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è CI
3. **629bd9a** - –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º CI
4. **ca09dd6** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π Ansible –≤ Docker

---

## –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ molecule:

```bash
# –°–æ–∑–¥–∞–π .env –∏ inventory.ini
cp env.example .env
cp inventory.ini.example inventory.ini
nano .env
nano inventory.ini

# –ó–∞–ø—É—Å—Ç–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
ansible-playbook -i inventory.ini site.yml
```

–≠—Ç–æ –æ–±–æ–π–¥–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Docker –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç —Ä–æ–ª—å –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–π —Å–∏—Å—Ç–µ–º–µ.
